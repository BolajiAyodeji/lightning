<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.1">
    <meta name="project" content="Lightning v0.8.2">

    <title>Lightning.Accounts â€” Lightning v0.8.2</title>
    <link rel="stylesheet" href="dist/html-elixir-V2ETBPMB.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-IV5W3OL2.js"></script>
    <script src="dist/sidebar_items-068BD01D.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-XN2TSG4M.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="https://openfn.github.io/Lightning">
        <img src="assets/logo.png" alt="Lightning" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="https://openfn.github.io/Lightning" class="sidebar-projectName" translate="no">
Lightning
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.8.2
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


        <li><a id="tasks-list-link" href="#full-list"><span translate="no">Mix</span> Tasks</a></li>

    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">Lightning.Accounts</span> 
  <small class="app-vsn" translate="no">(Lightning v0.8.2)</small>

</h1>


  <section id="moduledoc">
<p>The Accounts context.</p>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply_user_email/3" translate="no">apply_user_email(user, password, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Emulates that the email will change without actually changing
it in the database.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cancel_scheduled_deletion/1" translate="no">cancel_scheduled_deletion(user_id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_scheduled_deletion/2" translate="no">change_scheduled_deletion(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user scheduled_deletion.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_superuser_registration/1" translate="no">change_superuser_registration(attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking superuser changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_details/2" translate="no">change_user_details(user, attrs \\ %{})</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_email/2" translate="no">change_user_email(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user email.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_password/2" translate="no">change_user_password(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_registration/1" translate="no">change_user_registration(attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking user changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#confirm_user/1" translate="no">confirm_user(token)</a>

      </div>

        <div class="summary-synopsis"><p>Confirms a user by the given token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_auth_token/1" translate="no">delete_auth_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_session_token/1" translate="no">delete_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_sudo_session_token/1" translate="no">delete_sudo_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_token/1" translate="no">delete_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_user/1" translate="no">delete_user(user)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_user_totp/1" translate="no">delete_user_totp(totp)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the given user's TOTP</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_update_email_instructions/3" translate="no">deliver_update_email_instructions(user, current_email, update_email_url_fun)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the update email instructions to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_confirmation_instructions/2" translate="no">deliver_user_confirmation_instructions(user, confirmation_url_fun)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the confirmation email instructions to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_confirmation_instructions/3" translate="no">deliver_user_confirmation_instructions(registerer, user, confirmation_url_fun)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_reset_password_instructions/2" translate="no">deliver_user_reset_password_instructions(user, reset_password_url_fun)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the reset password email to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#exchange_auth_token/1" translate="no">exchange_auth_token(auth_token)</a>

      </div>

        <div class="summary-synopsis"><p>Exchanges an auth token for a session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_api_token/1" translate="no">generate_api_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates an API token for a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_auth_token/1" translate="no">generate_auth_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates an auth token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_sudo_session_token/1" translate="no">generate_sudo_session_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates a 2FA session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_user_session_token/1" translate="no">generate_user_session_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates a session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_token!/1" translate="no">get_token!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user!/1" translate="no">get_user!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_api_token/1" translate="no">get_user_by_api_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_auth_token/1" translate="no">get_user_by_auth_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_email/1" translate="no">get_user_by_email(email)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a user by email.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_email_and_password/2" translate="no">get_user_by_email_and_password(email, password)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a user by email and password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_reset_password_token/1" translate="no">get_user_by_reset_password_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user by reset password token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_session_token/1" translate="no">get_user_by_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_totp/1" translate="no">get_user_totp(user)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single UserTOTP if any exists.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_users_to_alert_for_project/1" translate="no">get_users_to_alert_for_project(map)</a>

      </div>

        <div class="summary-synopsis"><p>Gets all users to alert of workflow failure for a project</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_activity_in_projects?/1" translate="no">has_activity_in_projects?(user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_one_superuser?/0" translate="no">has_one_superuser?()</a>

      </div>

        <div class="summary-synopsis"><p>Used to determine if there is at least one Superuser in the system.
This triggers the setup page on fresh installs.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_api_tokens/1" translate="no">list_api_tokens(user)</a>

      </div>

        <div class="summary-synopsis"><p>Lists all user tokens</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_user_backup_codes/1" translate="no">list_user_backup_codes(user)</a>

      </div>

        <div class="summary-synopsis"><p>Lists the user backup codes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_users/0" translate="no">list_users()</a>

      </div>

        <div class="summary-synopsis"><p>Returns the list of users.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#perform/1" translate="no">perform(job)</a>

      </div>

        <div class="summary-synopsis"><p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;} will find users that are ready for permanent deletion and purge them.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#purge_user/1" translate="no">purge_user(id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#regenerate_user_backup_codes/1" translate="no">regenerate_user_backup_codes(user)</a>

      </div>

        <div class="summary-synopsis"><p>Regenerates the user backup codes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#register_superuser/1" translate="no">register_superuser(attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Registers a superuser.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#register_user/1" translate="no">register_user(attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Registers a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reset_user_password/2" translate="no">reset_user_password(user, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Resets the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#schedule_user_deletion/2" translate="no">schedule_user_deletion(user, email)</a>

      </div>

        <div class="summary-synopsis"><p>Given a user and a confirmation email, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic user purge cronjob will never
run. (Note that subsequent logins will be blocked for users pending deletion.)</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#sudo_session_token_valid?/2" translate="no">sudo_session_token_valid?(user, token)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if the given sudo token for the user is valid</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_details/2" translate="no">update_user_details(user, attrs \\ %{})</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_email/2" translate="no">update_user_email(user, token)</a>

      </div>

        <div class="summary-synopsis"><p>Updates the user email using the given token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_password/3" translate="no">update_user_password(user, password, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#upsert_user_totp/2" translate="no">upsert_user_totp(totp, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates or Inserts the user's TOTP</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#valid_user_backup_code?/2" translate="no">valid_user_backup_code?(user, code)</a>

      </div>

        <div class="summary-synopsis"><p>Validates if the given Backup code is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#valid_user_totp?/2" translate="no">valid_user_totp?(user, code)</a>

      </div>

        <div class="summary-synopsis"><p>Validates if the given TOTP code is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#validate_change_user_email/2" translate="no">validate_change_user_email(user, params)</a>

      </div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="apply_user_email/3">

  <div class="detail-header">
    <a href="#apply_user_email/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">apply_user_email(user, password, attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L433" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Emulates that the email will change without actually changing
it in the database.</p><h2 id="apply_user_email/3-examples" class="section-heading">
  <a href="#apply_user_email/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">apply_user_email</span><span class="p" data-group-id="5684185982-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;valid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5684185982-2">%{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="5684185982-2">}</span><span class="p" data-group-id="5684185982-1">)</span><span class="w">
</span><span class="p" data-group-id="5684185982-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5684185982-4">%</span><span class="nc" data-group-id="5684185982-4">User</span><span class="p" data-group-id="5684185982-4">{</span><span class="p" data-group-id="5684185982-4">}</span><span class="p" data-group-id="5684185982-3">}</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:superuser</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">apply_user_email</span><span class="p" data-group-id="5684185982-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5684185982-6">%{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="5684185982-6">}</span><span class="p" data-group-id="5684185982-5">)</span><span class="w">
</span><span class="p" data-group-id="5684185982-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5684185982-8">%</span><span class="nc" data-group-id="5684185982-8">Ecto.Changeset</span><span class="p" data-group-id="5684185982-8">{</span><span class="p" data-group-id="5684185982-8">}</span><span class="p" data-group-id="5684185982-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="cancel_scheduled_deletion/1">

  <div class="detail-header">
    <a href="#cancel_scheduled_deletion/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cancel_scheduled_deletion(user_id)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L413" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_scheduled_deletion/2">

    <span id="change_scheduled_deletion/1"></span>

  <div class="detail-header">
    <a href="#change_scheduled_deletion/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_scheduled_deletion(user, attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L409" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user scheduled_deletion.</p><h2 id="change_scheduled_deletion/2-examples" class="section-heading">
  <a href="#change_scheduled_deletion/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_scheduled_deletion</span><span class="p" data-group-id="1048480418-1">(</span><span class="n">user</span><span class="p" data-group-id="1048480418-1">)</span><span class="w">
</span><span class="p" data-group-id="1048480418-2">%</span><span class="nc" data-group-id="1048480418-2">Ecto.Changeset</span><span class="p" data-group-id="1048480418-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1048480418-3">%</span><span class="nc" data-group-id="1048480418-3">User</span><span class="p" data-group-id="1048480418-3">{</span><span class="p" data-group-id="1048480418-3">}</span><span class="p" data-group-id="1048480418-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_superuser_registration/1">

    <span id="change_superuser_registration/0"></span>

  <div class="detail-header">
    <a href="#change_superuser_registration/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_superuser_registration(attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L331" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_superuser_registration(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()</pre>

      </div>

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking superuser changes.</p><h2 id="change_superuser_registration/1-examples" class="section-heading">
  <a href="#change_superuser_registration/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_superuser_registration</span><span class="p" data-group-id="5793447182-1">(</span><span class="n">user</span><span class="p" data-group-id="5793447182-1">)</span><span class="w">
</span><span class="p" data-group-id="5793447182-2">%</span><span class="nc" data-group-id="5793447182-2">Ecto.Changeset</span><span class="p" data-group-id="5793447182-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5793447182-3">%</span><span class="nc" data-group-id="5793447182-3">User</span><span class="p" data-group-id="5793447182-3">{</span><span class="p" data-group-id="5793447182-3">}</span><span class="p" data-group-id="5793447182-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user_details/2">

    <span id="change_user_details/1"></span>

  <div class="detail-header">
    <a href="#change_user_details/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_user_details(user, attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L376" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_user_email/2">

    <span id="change_user_email/1"></span>

  <div class="detail-header">
    <a href="#change_user_email/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_user_email(user, attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L396" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user email.</p><h2 id="change_user_email/2-examples" class="section-heading">
  <a href="#change_user_email/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_email</span><span class="p" data-group-id="2577675785-1">(</span><span class="n">user</span><span class="p" data-group-id="2577675785-1">)</span><span class="w">
</span><span class="p" data-group-id="2577675785-2">%</span><span class="nc" data-group-id="2577675785-2">Ecto.Changeset</span><span class="p" data-group-id="2577675785-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2577675785-3">%</span><span class="nc" data-group-id="2577675785-3">User</span><span class="p" data-group-id="2577675785-3">{</span><span class="p" data-group-id="2577675785-3">}</span><span class="p" data-group-id="2577675785-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user_password/2">

    <span id="change_user_password/1"></span>

  <div class="detail-header">
    <a href="#change_user_password/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_user_password(user, attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L564" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user password.</p><h2 id="change_user_password/2-examples" class="section-heading">
  <a href="#change_user_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_password</span><span class="p" data-group-id="5730221714-1">(</span><span class="n">user</span><span class="p" data-group-id="5730221714-1">)</span><span class="w">
</span><span class="p" data-group-id="5730221714-2">%</span><span class="nc" data-group-id="5730221714-2">Ecto.Changeset</span><span class="p" data-group-id="5730221714-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5730221714-3">%</span><span class="nc" data-group-id="5730221714-3">User</span><span class="p" data-group-id="5730221714-3">{</span><span class="p" data-group-id="5730221714-3">}</span><span class="p" data-group-id="5730221714-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user_registration/1">

    <span id="change_user_registration/0"></span>

  <div class="detail-header">
    <a href="#change_user_registration/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_user_registration(attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L372" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking user changes.</p><h2 id="change_user_registration/1-examples" class="section-heading">
  <a href="#change_user_registration/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_registration</span><span class="p" data-group-id="3461933523-1">(</span><span class="n">user</span><span class="p" data-group-id="3461933523-1">)</span><span class="w">
</span><span class="p" data-group-id="3461933523-2">%</span><span class="nc" data-group-id="3461933523-2">Ecto.Changeset</span><span class="p" data-group-id="3461933523-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3461933523-3">%</span><span class="nc" data-group-id="3461933523-3">User</span><span class="p" data-group-id="3461933523-3">{</span><span class="p" data-group-id="3461933523-3">}</span><span class="p" data-group-id="3461933523-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="confirm_user/1">

  <div class="detail-header">
    <a href="#confirm_user/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">confirm_user(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L837" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Confirms a user by the given token.</p><p>If the token matches, the user account is marked as confirmed
and the token is deleted.</p>
  </section>
</section>
<section class="detail" id="delete_auth_token/1">

  <div class="detail-header">
    <a href="#delete_auth_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_auth_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L724" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_session_token/1">

  <div class="detail-header">
    <a href="#delete_session_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_session_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L650" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_sudo_session_token/1">

  <div class="detail-header">
    <a href="#delete_sudo_session_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_sudo_session_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L680" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_token/1">

  <div class="detail-header">
    <a href="#delete_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L760" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Deletes a token.</p><h2 id="delete_token/1-examples" class="section-heading">
  <a href="#delete_token/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">delete_token</span><span class="p" data-group-id="1187650678-1">(</span><span class="n">token</span><span class="p" data-group-id="1187650678-1">)</span><span class="w">
</span><span class="p" data-group-id="1187650678-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1187650678-3">%</span><span class="nc" data-group-id="1187650678-3">UserToken</span><span class="p" data-group-id="1187650678-3">{</span><span class="p" data-group-id="1187650678-3">}</span><span class="p" data-group-id="1187650678-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">delete_token</span><span class="p" data-group-id="1187650678-4">(</span><span class="n">token</span><span class="p" data-group-id="1187650678-4">)</span><span class="w">
</span><span class="p" data-group-id="1187650678-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1187650678-6">%</span><span class="nc" data-group-id="1187650678-6">Ecto.Changeset</span><span class="p" data-group-id="1187650678-6">{</span><span class="p" data-group-id="1187650678-6">}</span><span class="p" data-group-id="1187650678-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_user/1">

  <div class="detail-header">
    <a href="#delete_user/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_user(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L551" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Deletes a user.</p><h2 id="delete_user/1-examples" class="section-heading">
  <a href="#delete_user/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">delete_user</span><span class="p" data-group-id="5528816024-1">(</span><span class="n">user</span><span class="p" data-group-id="5528816024-1">)</span><span class="w">
</span><span class="p" data-group-id="5528816024-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5528816024-3">%</span><span class="nc" data-group-id="5528816024-3">User</span><span class="p" data-group-id="5528816024-3">{</span><span class="p" data-group-id="5528816024-3">}</span><span class="p" data-group-id="5528816024-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">delete_user</span><span class="p" data-group-id="5528816024-4">(</span><span class="n">user</span><span class="p" data-group-id="5528816024-4">)</span><span class="w">
</span><span class="p" data-group-id="5528816024-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5528816024-6">%</span><span class="nc" data-group-id="5528816024-6">Ecto.Changeset</span><span class="p" data-group-id="5528816024-6">{</span><span class="p" data-group-id="5528816024-6">}</span><span class="p" data-group-id="5528816024-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_user_totp/1">

  <div class="detail-header">
    <a href="#delete_user_totp/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_user_totp(totp)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L210" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_user_totp(<a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()) ::
  {:ok, <a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Deletes the given user's TOTP</p>
  </section>
</section>
<section class="detail" id="deliver_update_email_instructions/3">

  <div class="detail-header">
    <a href="#deliver_update_email_instructions/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">deliver_update_email_instructions(user, current_email, update_email_url_fun)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L484" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delivers the update email instructions to the given user.</p><h2 id="deliver_update_email_instructions/3-examples" class="section-heading">
  <a href="#deliver_update_email_instructions/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">deliver_update_email_instructions</span><span class="p" data-group-id="5945272996-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">current_email</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_update_email_url</span><span class="p" data-group-id="5945272996-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="5945272996-2">)</span><span class="p" data-group-id="5945272996-1">)</span><span class="w">
</span><span class="p" data-group-id="5945272996-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5945272996-4">%{</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="5945272996-4">}</span><span class="p" data-group-id="5945272996-3">}</span></code></pre>
  </section>
</section>
<section class="detail" id="deliver_user_confirmation_instructions/2">

  <div class="detail-header">
    <a href="#deliver_user_confirmation_instructions/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">deliver_user_confirmation_instructions(user, confirmation_url_fun)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L795" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delivers the confirmation email instructions to the given user.</p><h2 id="deliver_user_confirmation_instructions/2-examples" class="section-heading">
  <a href="#deliver_user_confirmation_instructions/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_confirmation_instructions</span><span class="p" data-group-id="5125651069-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_confirmation_url</span><span class="p" data-group-id="5125651069-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="5125651069-2">)</span><span class="p" data-group-id="5125651069-1">)</span><span class="w">
</span><span class="p" data-group-id="5125651069-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5125651069-4">%{</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="5125651069-4">}</span><span class="p" data-group-id="5125651069-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_confirmation_instructions</span><span class="p" data-group-id="5125651069-5">(</span><span class="n">confirmed_user</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_confirmation_url</span><span class="p" data-group-id="5125651069-6">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="5125651069-6">)</span><span class="p" data-group-id="5125651069-5">)</span><span class="w">
</span><span class="p" data-group-id="5125651069-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:already_confirmed</span><span class="p" data-group-id="5125651069-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="deliver_user_confirmation_instructions/3">

  <div class="detail-header">
    <a href="#deliver_user_confirmation_instructions/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">deliver_user_confirmation_instructions(registerer, user, confirmation_url_fun)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L812" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="deliver_user_reset_password_instructions/2">

  <div class="detail-header">
    <a href="#deliver_user_reset_password_instructions/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">deliver_user_reset_password_instructions(user, reset_password_url_fun)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L867" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delivers the reset password email to the given user.</p><h2 id="deliver_user_reset_password_instructions/2-examples" class="section-heading">
  <a href="#deliver_user_reset_password_instructions/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_reset_password_instructions</span><span class="p" data-group-id="2813883875-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_reset_password_url</span><span class="p" data-group-id="2813883875-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="2813883875-2">)</span><span class="p" data-group-id="2813883875-1">)</span><span class="w">
</span><span class="p" data-group-id="2813883875-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2813883875-4">%{</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="2813883875-4">}</span><span class="p" data-group-id="2813883875-3">}</span></code></pre>
  </section>
</section>
<section class="detail" id="exchange_auth_token/1">

  <div class="detail-header">
    <a href="#exchange_auth_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">exchange_auth_token(auth_token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L702" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Exchanges an auth token for a session token.</p><p>The auth token is removed from the database if successful.</p>
  </section>
</section>
<section class="detail" id="generate_api_token/1">

  <div class="detail-header">
    <a href="#generate_api_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_api_token(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L734" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generates an API token for a user.</p>
  </section>
</section>
<section class="detail" id="generate_auth_token/1">

  <div class="detail-header">
    <a href="#generate_auth_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_auth_token(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L691" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generates an auth token.</p>
  </section>
</section>
<section class="detail" id="generate_sudo_session_token/1">

  <div class="detail-header">
    <a href="#generate_sudo_session_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_sudo_session_token(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L660" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generates a 2FA session token.</p>
  </section>
</section>
<section class="detail" id="generate_user_session_token/1">

  <div class="detail-header">
    <a href="#generate_user_session_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_user_session_token(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L633" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generates a session token.</p>
  </section>
</section>
<section class="detail" id="get_token!/1">

  <div class="detail-header">
    <a href="#get_token!/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_token!(id)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L167" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets a single token.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the UserToken does not exist.</p><h2 id="get_token!/1-examples" class="section-heading">
  <a href="#get_token!/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_token!</span><span class="p" data-group-id="8912263147-1">(</span><span class="mi">123</span><span class="p" data-group-id="8912263147-1">)</span><span class="w">
</span><span class="p" data-group-id="8912263147-2">%</span><span class="nc" data-group-id="8912263147-2">UserToken</span><span class="p" data-group-id="8912263147-2">{</span><span class="p" data-group-id="8912263147-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_token!</span><span class="p" data-group-id="8912263147-3">(</span><span class="mi">456</span><span class="p" data-group-id="8912263147-3">)</span><span class="w">
</span><span class="gt">** (Ecto.NoResultsError)</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user!/1">

  <div class="detail-header">
    <a href="#get_user!/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user!(id)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L151" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets a single user.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the User does not exist.</p><h2 id="get_user!/1-examples" class="section-heading">
  <a href="#get_user!/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user!</span><span class="p" data-group-id="1664329503-1">(</span><span class="mi">123</span><span class="p" data-group-id="1664329503-1">)</span><span class="w">
</span><span class="p" data-group-id="1664329503-2">%</span><span class="nc" data-group-id="1664329503-2">User</span><span class="p" data-group-id="1664329503-2">{</span><span class="p" data-group-id="1664329503-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user!</span><span class="p" data-group-id="1664329503-3">(</span><span class="mi">456</span><span class="p" data-group-id="1664329503-3">)</span><span class="w">
</span><span class="gt">** (Ecto.NoResultsError)</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_api_token/1">

  <div class="detail-header">
    <a href="#get_user_by_api_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_api_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L743" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_by_auth_token/1">

  <div class="detail-header">
    <a href="#get_user_by_auth_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_auth_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L716" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_by_email/1">

  <div class="detail-header">
    <a href="#get_user_by_email/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_email(email)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L115" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets a user by email.</p><h2 id="get_user_by_email/1-examples" class="section-heading">
  <a href="#get_user_by_email/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email</span><span class="p" data-group-id="3418256194-1">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p" data-group-id="3418256194-1">)</span><span class="w">
</span><span class="p" data-group-id="3418256194-2">%</span><span class="nc" data-group-id="3418256194-2">User</span><span class="p" data-group-id="3418256194-2">{</span><span class="p" data-group-id="3418256194-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email</span><span class="p" data-group-id="3418256194-3">(</span><span class="s">&quot;unknown@example.com&quot;</span><span class="p" data-group-id="3418256194-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_email_and_password/2">

  <div class="detail-header">
    <a href="#get_user_by_email_and_password/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_email_and_password(email, password)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L131" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets a user by email and password.</p><h2 id="get_user_by_email_and_password/2-examples" class="section-heading">
  <a href="#get_user_by_email_and_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email_and_password</span><span class="p" data-group-id="9834226263-1">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;correct_password&quot;</span><span class="p" data-group-id="9834226263-1">)</span><span class="w">
</span><span class="p" data-group-id="9834226263-2">%</span><span class="nc" data-group-id="9834226263-2">User</span><span class="p" data-group-id="9834226263-2">{</span><span class="p" data-group-id="9834226263-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email_and_password</span><span class="p" data-group-id="9834226263-3">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid_password&quot;</span><span class="p" data-group-id="9834226263-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_reset_password_token/1">

  <div class="detail-header">
    <a href="#get_user_by_reset_password_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_reset_password_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L895" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets the user by reset password token.</p><h2 id="get_user_by_reset_password_token/1-examples" class="section-heading">
  <a href="#get_user_by_reset_password_token/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_reset_password_token</span><span class="p" data-group-id="8942221330-1">(</span><span class="s">&quot;validtoken&quot;</span><span class="p" data-group-id="8942221330-1">)</span><span class="w">
</span><span class="p" data-group-id="8942221330-2">%</span><span class="nc" data-group-id="8942221330-2">User</span><span class="p" data-group-id="8942221330-2">{</span><span class="p" data-group-id="8942221330-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_reset_password_token</span><span class="p" data-group-id="8942221330-3">(</span><span class="s">&quot;invalidtoken&quot;</span><span class="p" data-group-id="8942221330-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_session_token/1">

  <div class="detail-header">
    <a href="#get_user_by_session_token/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_by_session_token(token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L642" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_totp/1">

  <div class="detail-header">
    <a href="#get_user_totp/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user_totp(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L172" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets a single UserTOTP if any exists.</p>
  </section>
</section>
<section class="detail" id="get_users_to_alert_for_project/1">

  <div class="detail-header">
    <a href="#get_users_to_alert_for_project/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_users_to_alert_for_project(map)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L944" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Gets all users to alert of workflow failure for a project</p>
  </section>
</section>
<section class="detail" id="has_activity_in_projects?/1">

  <div class="detail-header">
    <a href="#has_activity_in_projects?/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_activity_in_projects?(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L26" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="has_one_superuser?/0">

  <div class="detail-header">
    <a href="#has_one_superuser?/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_one_superuser?()</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L936" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> has_one_superuser?() :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Used to determine if there is at least one Superuser in the system.
This triggers the setup page on fresh installs.</p>
  </section>
</section>
<section class="detail" id="list_api_tokens/1">

  <div class="detail-header">
    <a href="#list_api_tokens/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_api_tokens(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L767" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Lists all user tokens</p>
  </section>
</section>
<section class="detail" id="list_user_backup_codes/1">

  <div class="detail-header">
    <a href="#list_user_backup_codes/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_user_backup_codes(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L292" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_user_backup_codes(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  [<a href="Lightning.Accounts.UserBackupCode.html#t:t/0">Lightning.Accounts.UserBackupCode.t</a>(), ...] | []</pre>

      </div>

<p>Lists the user backup codes</p>
  </section>
</section>
<section class="detail" id="list_users/0">

  <div class="detail-header">
    <a href="#list_users/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_users()</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L99" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Returns the list of users.</p><h2 id="list_users/0-examples" class="section-heading">
  <a href="#list_users/0-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">list_users</span><span class="p" data-group-id="8703314831-1">(</span><span class="p" data-group-id="8703314831-1">)</span><span class="w">
</span><span class="p" data-group-id="8703314831-2">[</span><span class="p" data-group-id="8703314831-3">%</span><span class="nc" data-group-id="8703314831-3">User</span><span class="p" data-group-id="8703314831-3">{</span><span class="p" data-group-id="8703314831-3">}</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="8703314831-2">]</span></code></pre>
  </section>
</section>
<section class="detail" id="perform/1">

  <div class="detail-header">
    <a href="#perform/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">perform(job)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L68" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;} will find users that are ready for permanent deletion and purge them.</p>
  </section>
</section>
<section class="detail" id="purge_user/1">

  <div class="detail-header">
    <a href="#purge_user/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">purge_user(id)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L38" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> purge_user(id :: <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: :ok</pre>

      </div>


  </section>
</section>
<section class="detail" id="regenerate_user_backup_codes/1">

  <div class="detail-header">
    <a href="#regenerate_user_backup_codes/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">regenerate_user_backup_codes(user)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L275" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> regenerate_user_backup_codes(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  {:ok, <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Regenerates the user backup codes</p>
  </section>
</section>
<section class="detail" id="register_superuser/1">

  <div class="detail-header">
    <a href="#register_superuser/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">register_superuser(attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L309" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Registers a superuser.</p><h2 id="register_superuser/1-examples" class="section-heading">
  <a href="#register_superuser/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">register_superuser</span><span class="p" data-group-id="9064894962-1">(</span><span class="p" data-group-id="9064894962-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="9064894962-2">}</span><span class="p" data-group-id="9064894962-1">)</span><span class="w">
</span><span class="p" data-group-id="9064894962-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9064894962-4">%</span><span class="nc" data-group-id="9064894962-4">User</span><span class="p" data-group-id="9064894962-4">{</span><span class="p" data-group-id="9064894962-4">}</span><span class="p" data-group-id="9064894962-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">register_superuser</span><span class="p" data-group-id="9064894962-5">(</span><span class="p" data-group-id="9064894962-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="9064894962-6">}</span><span class="p" data-group-id="9064894962-5">)</span><span class="w">
</span><span class="p" data-group-id="9064894962-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9064894962-8">%</span><span class="nc" data-group-id="9064894962-8">Ecto.Changeset</span><span class="p" data-group-id="9064894962-8">{</span><span class="p" data-group-id="9064894962-8">}</span><span class="p" data-group-id="9064894962-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="register_user/1">

  <div class="detail-header">
    <a href="#register_user/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">register_user(attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L351" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> register_user(
  :invalid
  | %{optional(:__struct__) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">none</a>(), optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}
) ::
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()</pre>

      </div>

<p>Registers a user.</p><h2 id="register_user/1-examples" class="section-heading">
  <a href="#register_user/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">register_user</span><span class="p" data-group-id="9500340190-1">(</span><span class="p" data-group-id="9500340190-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="9500340190-2">}</span><span class="p" data-group-id="9500340190-1">)</span><span class="w">
</span><span class="p" data-group-id="9500340190-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9500340190-4">%</span><span class="nc" data-group-id="9500340190-4">User</span><span class="p" data-group-id="9500340190-4">{</span><span class="p" data-group-id="9500340190-4">}</span><span class="p" data-group-id="9500340190-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">register_user</span><span class="p" data-group-id="9500340190-5">(</span><span class="p" data-group-id="9500340190-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="9500340190-6">}</span><span class="p" data-group-id="9500340190-5">)</span><span class="w">
</span><span class="p" data-group-id="9500340190-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9500340190-8">%</span><span class="nc" data-group-id="9500340190-8">Ecto.Changeset</span><span class="p" data-group-id="9500340190-8">{</span><span class="p" data-group-id="9500340190-8">}</span><span class="p" data-group-id="9500340190-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="reset_user_password/2">

  <div class="detail-header">
    <a href="#reset_user_password/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset_user_password(user, attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L917" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Resets the user password.</p><h2 id="reset_user_password/2-examples" class="section-heading">
  <a href="#reset_user_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">reset_user_password</span><span class="p" data-group-id="1412611105-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1412611105-2">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;new long password&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">password_confirmation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;new long password&quot;</span><span class="p" data-group-id="1412611105-2">}</span><span class="p" data-group-id="1412611105-1">)</span><span class="w">
</span><span class="p" data-group-id="1412611105-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1412611105-4">%</span><span class="nc" data-group-id="1412611105-4">User</span><span class="p" data-group-id="1412611105-4">{</span><span class="p" data-group-id="1412611105-4">}</span><span class="p" data-group-id="1412611105-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">reset_user_password</span><span class="p" data-group-id="1412611105-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1412611105-6">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;valid&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">password_confirmation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;not the same&quot;</span><span class="p" data-group-id="1412611105-6">}</span><span class="p" data-group-id="1412611105-5">)</span><span class="w">
</span><span class="p" data-group-id="1412611105-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1412611105-8">%</span><span class="nc" data-group-id="1412611105-8">Ecto.Changeset</span><span class="p" data-group-id="1412611105-8">{</span><span class="p" data-group-id="1412611105-8">}</span><span class="p" data-group-id="1412611105-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="schedule_user_deletion/2">

  <div class="detail-header">
    <a href="#schedule_user_deletion/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">schedule_user_deletion(user, email)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L605" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Given a user and a confirmation email, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic user purge cronjob will never
run. (Note that subsequent logins will be blocked for users pending deletion.)</p>
  </section>
</section>
<section class="detail" id="sudo_session_token_valid?/2">

  <div class="detail-header">
    <a href="#sudo_session_token_valid?/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">sudo_session_token_valid?(user, token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L669" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Checks if the given sudo token for the user is valid</p>
  </section>
</section>
<section class="detail" id="update_user_details/2">

    <span id="update_user_details/1"></span>

  <div class="detail-header">
    <a href="#update_user_details/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_user_details(user, attrs \\ %{})</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L380" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_user_email/2">

  <div class="detail-header">
    <a href="#update_user_email/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_user_email(user, token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L446" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Updates the user email using the given token.</p><p>If the token matches, the user email is updated and the token is deleted.
The confirmed_at date is also updated to the current time.</p>
  </section>
</section>
<section class="detail" id="update_user_password/3">

  <div class="detail-header">
    <a href="#update_user_password/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_user_password(user, password, attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L580" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Updates the user password.</p><h2 id="update_user_password/3-examples" class="section-heading">
  <a href="#update_user_password/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">examples</p>
  </a>
  Examples
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_user_password</span><span class="p" data-group-id="6728422512-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;valid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6728422512-2">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6728422512-2">}</span><span class="p" data-group-id="6728422512-1">)</span><span class="w">
</span><span class="p" data-group-id="6728422512-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6728422512-4">%</span><span class="nc" data-group-id="6728422512-4">User</span><span class="p" data-group-id="6728422512-4">{</span><span class="p" data-group-id="6728422512-4">}</span><span class="p" data-group-id="6728422512-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">update_user_password</span><span class="p" data-group-id="6728422512-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6728422512-6">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6728422512-6">}</span><span class="p" data-group-id="6728422512-5">)</span><span class="w">
</span><span class="p" data-group-id="6728422512-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6728422512-8">%</span><span class="nc" data-group-id="6728422512-8">Ecto.Changeset</span><span class="p" data-group-id="6728422512-8">{</span><span class="p" data-group-id="6728422512-8">}</span><span class="p" data-group-id="6728422512-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="upsert_user_totp/2">

  <div class="detail-header">
    <a href="#upsert_user_totp/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">upsert_user_totp(totp, attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L181" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> upsert_user_totp(<a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) ::
  {:ok, <a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.10.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Updates or Inserts the user's TOTP</p>
  </section>
</section>
<section class="detail" id="valid_user_backup_code?/2">

  <div class="detail-header">
    <a href="#valid_user_backup_code?/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">valid_user_backup_code?(user, code)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L238" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> valid_user_backup_code?(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) :: true | false</pre>

      </div>

<p>Validates if the given Backup code is valid.</p>
  </section>
</section>
<section class="detail" id="valid_user_totp?/2">

  <div class="detail-header">
    <a href="#valid_user_totp?/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">valid_user_totp?(user, code)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L228" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> valid_user_totp?(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) :: true | false</pre>

      </div>

<p>Validates if the given TOTP code is valid.</p>
  </section>
</section>
<section class="detail" id="validate_change_user_email/2">

  <div class="detail-header">
    <a href="#validate_change_user_email/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">validate_change_user_email(user, params)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L506" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Lightning.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
